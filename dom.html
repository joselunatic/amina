<!DOCTYPE html>
<html lang="es"><head>
    <meta charset="UTF--8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMINA // Análisis de Misiones e Investigación de Nuevas Amenazas</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
  </head>
  <body class="crt booting mobile-mode is-mobile mode-agent" data-mobile-tab="map">
    <div id="boot-screen" class="boot-screen active">
      <div class="boot-monitor">
        <div class="boot-frame">
          <div class="boot-crt">
            <div class="boot-scanline"></div>
            <pre id="boot-output"></pre>
          </div>
        </div>
        <div class="boot-console">
          <div class="boot-console-header">
            <span>AMINA // ANÁLISIS DE MISIONES E INVESTIGACIÓN DE NUEVAS AMENAZAS</span>
            <span>DIV. DE OPERACIONES DE MEMBRANA</span>
          </div>
          <div class="boot-console-body">
            <div id="boot-menu" class="boot-menu hidden">
              <button id="boot-player">CANAL DE AGENTE DE CAMPO</button>
              <button id="boot-dm">ACCESO SR. VERDAD</button>
            </div>
            <div id="agent-login" class="agent-login hidden">
              <label for="agent-select">Agente</label>
              <select id="agent-select"></select>
              <label for="agent-pass">Contraseña de Agente</label>
              <input type="password" id="agent-pass" autocomplete="off">
              <button type="button" id="agent-login-button">Autorizar</button>
              <p id="agent-login-status" class="boot-status"></p>
            </div>
            <div id="command-menu" class="command-menu hidden text-left">
              <div class="command-header">INTERFAZ DE COMANDOS</div>
              <div id="command-log" class="command-log text-xs italic">
                listo // escriba MOSTRAR MAPA AMINA o MOSTRAR BANDEJA DE ENTRADA
              </div>
              <input id="command-input" type="text" class="command-input" value="MOSTRAR MAPA AMINA">
              <div class="command-actions">
                <button type="button" id="command-map">MOSTRAR MAPA AMINA</button>
                <button type="button" id="command-inbox">MOSTRAR BANDEJA DE ENTRADA</button>
              </div>
            </div>
            <form id="boot-dm-form" class="boot-dm-form">
              <label for="boot-dm-secret">CÓDIGO DE ACCESO SR. VERDAD</label>
              <input type="password" id="boot-dm-secret" autocomplete="off">
              <div class="boot-actions">
                <button type="submit">ACCEDER</button>
                <button type="button" id="boot-cancel">CANCELAR</button>
              </div>
              <p id="boot-status" class="boot-status"></p>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="crt-screen">
      <header class="amina-topbar">
        <div class="top-ticker">
          <span class="top-ticker-label">FEED GLOBAL OV</span>
          <div class="top-ticker-track">
            <div id="ticker-track">
              <span class="ticker-placeholder">Esperando despachos de membrana…</span>
            </div>
          </div>
        </div>
      </header>
      <main class="app-shell">
        <div class="app-layout">
          <section class="control-panel" id="control-panel">
            <header class="panel-header" data-mobile-section="header">
              <button id="panel-toggle" class="panel-toggle" aria-label="Toggle sidebar" aria-expanded="true"></button>
              <div class="brand-lockup">
                <h1>AMINA</h1>
                <p class="brand-expansion">Análisis de Misiones e Investigación de Nuevas Amenazas</p>
              </div>
              <p class="brand-location">Sector: Schuylkill County // Consola de Campo Ordo Veritatis</p>
            </header>

            <section class="panel-section collapsible" id="dm-controls" data-mobile-section="clearance">
              <button class="collapsible-toggle" aria-expanded="true">
                <span>Autorización</span>
                <span class="collapsible-icon">−</span>
              </button>
              <div class="collapsible-body">
                <input type="hidden" id="dm-secret">
                <p class="clearance-status" id="clearance-status">Agente de Campo</p>
                <p class="clearance-status" id="agent-status"></p>
                <p class="dm-warning" id="dm-warning" role="alert"></p>
                <div class="dm-control-actions">
                  <button type="button" id="clearance-reset" class="ghost small">Cambiar Autorización</button>
                  <button type="button" id="dm-form-open" class="ghost small dm-only">Panel de PdI</button>
                </div>
              </div>
            </section>

            <section class="panel-section collapsible" data-mobile-section="filters">
              <button class="collapsible-toggle" aria-expanded="false">
                <span>Filtros</span>
                <span class="collapsible-icon">+</span>
              </button>
              <div class="collapsible-body collapsed">
                <form id="filter-form">
                  <label for="category-filter">Categoría</label>
                  <select id="category-filter">
                    <option value="">Todos</option>
                  <option value="OV_BASE">Base OV</option><option value="CRIME_SCENE">Escena del Crimen</option><option value="ESOTERROR_CELL">Célula Esoterrorista</option><option value="MUNDANE_TOWN">Pueblo Mundano</option><option value="INDUSTRIAL_SITE">Sitio Industrial</option><option value="NATURAL_SITE">Sitio Natural</option><option value="NPC">PNJ Clave</option><option value="RUMOR">Rumor</option></select>
                  <label for="session-filter">Etiqueta de sesión</label>
                  <input type="text" id="session-filter" placeholder="1x01">
                  <button type="submit">Aplicar filtros</button>
                </form>
              </div>
            </section>

            <section class="panel-section poi-list-section collapsible collapsed-section" data-mobile-section="pois">
              <button class="collapsible-toggle" aria-expanded="false">
                <span>Puntos de Interés</span>
                <span class="collapsible-icon">+</span>
              </button>
              <div class="collapsible-body collapsed">
                <ul id="poi-list"></ul>
              </div>
            </section>
          </section>

          <section class="main-column" id="main-column">
            <div class="map-shell">
              <section class="map-panel" id="map-panel">
                <button id="map-collapse-toggle" class="panel-toggle panel-toggle-floating" aria-label="Colapsar barra lateral" aria-expanded="true"></button>
                <div id="map" class="mapboxgl-map"><div class="mapboxgl-canary" style="visibility: hidden;"></div><div class="mapboxgl-canvas-container mapboxgl-interactive mapboxgl-touch-drag-pan mapboxgl-touch-zoom-rotate"><canvas class="mapboxgl-canvas" tabindex="0" aria-label="Map" role="region" width="400" height="300" style="width: 400px; height: 300px;"></canvas></div><div class="mapboxgl-control-container"><div class="mapboxgl-ctrl-top-left"></div><div class="mapboxgl-ctrl-top-right"><div class="mapboxgl-ctrl mapboxgl-ctrl-group"><button class="mapboxgl-ctrl-zoom-in" type="button" aria-label="Zoom in" aria-disabled="false"><span class="mapboxgl-ctrl-icon" aria-hidden="true" title="Zoom in"></span></button><button class="mapboxgl-ctrl-zoom-out" type="button" aria-label="Zoom out" aria-disabled="false"><span class="mapboxgl-ctrl-icon" aria-hidden="true" title="Zoom out"></span></button><button class="mapboxgl-ctrl-compass" type="button" aria-label="Reset bearing to north"><span class="mapboxgl-ctrl-icon" aria-hidden="true" title="Reset bearing to north" style="transform: rotate(0deg);"></span></button></div><div class="mapboxgl-ctrl mapboxgl-ctrl-group"><button class="mapboxgl-ctrl-fullscreen" type="button" aria-label="Enter fullscreen"><span class="mapboxgl-ctrl-icon" aria-hidden="true" title="Enter fullscreen"></span></button></div></div><div class="mapboxgl-ctrl-bottom-left"><div class="mapboxgl-ctrl" style="display: block;"><a class="mapboxgl-ctrl-logo mapboxgl-compact" target="_blank" rel="noopener nofollow" href="https://www.mapbox.com/" aria-label="Mapbox logo"></a></div></div><div class="mapboxgl-ctrl-bottom-right"><div class="mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-attrib-empty mapboxgl-compact"><button class="mapboxgl-ctrl-attrib-button" type="button" aria-label="Toggle attribution"><span class="mapboxgl-ctrl-icon" aria-hidden="true" title="Toggle attribution"></span></button><div class="mapboxgl-ctrl-attrib-inner" role="list"></div></div></div></div></div>
                <div id="message-bar"></div>
                <div class="brand-watermark">AMINA / Monitor de integridad de la Membrana</div>
              </section>
            </div>

            <nav class="workspace-nav" aria-label="Modo de consola">
              <div class="workspace-tabs agent-tabs">
                <button type="button" class="workspace-tab active" data-view="map">Mapa</button>
                <button type="button" class="workspace-tab" data-view="poi">PdI</button>
                <button type="button" class="workspace-tab" data-view="inbox">Buzón</button>
                <button type="button" class="workspace-tab" data-view="mission">Misión</button>
                <button type="button" class="workspace-tab" data-view="dossiers">Dossiers</button>
              </div>
              <div class="workspace-tabs dm-tabs">
                <button type="button" class="workspace-tab active" data-view="map">Mapa</button>
                <button type="button" class="workspace-tab" data-view="dispatch">Despacho</button>
                <button type="button" class="workspace-tab" data-view="poi">PdI</button>
                <button type="button" class="workspace-tab" data-view="mission">Misión</button>
                <button type="button" class="workspace-tab" data-view="dossiers">Dossiers</button>
              </div>
            </nav>

            <section class="workspace" id="workspace">
              <div class="workspace-view agent-view active" data-view="map">
                <div class="console-card focal-card" id="focal-poi-card">
                  <div class="card-title">PDI FOCAL</div>
                  <div class="console-card-body" id="focal-poi-content">Ningún PdI seleccionado. Elige uno del mapa o de la lista.</div>
                </div>
              </div>
              <div class="workspace-view agent-view" data-view="poi">
                <div class="console-card focal-card" id="focal-poi-card-copy">
                  <div class="card-title">PDI FOCAL</div>
                  <div class="console-card-body" id="focal-poi-content-copy">Ningún PdI seleccionado. Elige uno del mapa o de la lista.</div>
                </div>
              </div>
              <div class="workspace-view agent-view" data-view="inbox">
                <div class="console-card inbox-card" id="console-message-card">
                  <div class="card-title">BUZÓN <span id="msg-box-label" class="badge-soft">Entrada</span></div>
                  <div class="inbox-controls">
                    <button type="button" id="msg-box-toggle" class="small ghost">Enviados</button>
                    <div class="inbox-nav">
                      <button type="button" id="msg-prev" class="small ghost">Ant</button>
                      <button type="button" id="msg-next" class="small ghost">Sig</button>
                      <button type="button" id="msg-reply" class="small ghost">Responder</button>
                    </div>
                  </div>
                  <div class="reply-pane hidden" id="mailbox-reply">
                    <div class="reply-header">
                      <span class="reply-label" id="reply-label">Respondiendo a</span>
                      <button type="button" id="reply-cancel" class="small ghost">Cancelar</button>
                    </div>
                    <textarea id="reply-body" rows="3" placeholder="Compón tu respuesta…"></textarea>
                    <div class="form-actions">
                      <button type="button" id="reply-send" class="ghost">Enviar Respuesta</button>
                    </div>
                  </div>
                  <div class="console-card-body" id="console-message-content">No hay despachos.</div>
                </div>
              </div>
              <div class="workspace-view agent-view" data-view="mission">
                <div class="console-card mission-card" id="mission-brief-card">
                  <div class="card-title">INFORME DE MISIÓN</div>
                  <div class="console-card-body" id="mission-brief-text">Esperando directivas.</div>
                </div>
              </div>
              <div class="workspace-view agent-view" data-view="dossiers">
                <div class="console-card dossier-card" id="dossier-card">
                  <div class="card-title">DOSSIERS</div>
                  <div class="dossier-controls">
                    <div class="dossier-filter-group">
                      <button type="button" class="small ghost dossier-type" data-dossier-type="">Todos</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="pc">PJ</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="npc">PNJ</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="org">Orgs</button>
                    </div>
                    <input type="search" id="dossier-search" placeholder="Buscar nombre o callsign">
                  </div>
                  <div class="dossier-layout">
                    <div class="dossier-list" id="dossier-list"></div>
                    <div class="dossier-detail" id="dossier-detail">Selecciona una entidad para ver su dossier.</div>
                  </div>
                </div>
              </div>

              <div class="workspace-view dm-view active" data-view="map">
                <div class="console-card mission-card" id="dm-map-context-card">
                  <div class="card-title">Contexto</div>
                  <div class="console-card-body" id="dm-map-context">Mapa operativo activo.</div>
                </div>
              </div>
              <div class="workspace-view dm-view" data-view="dispatch">
                <div class="dispatch-layout">
                  <form id="message-form" class="message-form dm-only">
                    <label for="message-from">De</label>
                    <input type="text" id="message-from" value="Sr. Verdad" required="">

                    <label for="message-to">Para</label>
                    <select id="message-to" required="">
                      <option value="Howard Pike">Howard Pike</option>
                      <option value="Victoria Allen">Victoria Allen</option>
                      <option value="Billy Bob">Billy Bob</option>
                      <option value="Agent Local">Agente Local</option>
                    </select>

                    <label for="message-subject">Asunto</label>
                    <input type="text" id="message-subject" placeholder="Asunto..." required="">

                    <label for="message-session">Etiqueta de sesión</label>
                    <input type="text" id="message-session" placeholder="1x02">

                    <label for="message-body">Cuerpo</label>
                    <textarea id="message-body" rows="4" required=""></textarea>

                    <div class="form-actions">
                      <button type="submit" id="message-submit">Emitir</button>
                      <button type="button" id="message-clear" class="ghost">Limpiar</button>
                    </div>
                  </form>
                  <div class="message-feed-wrapper">
            <div class="message-filters">
              <label for="filter-box">Ver</label>
              <select id="filter-box">
                <option value="">Entrada</option>
                <option value="sent">Enviados</option>
              </select>

              <label for="filter-recipient">Destinatario</label>
              <select id="filter-recipient">
                <option value="">Todos los agentes</option>
              </select>
              <label for="filter-session">Sesión</label>
              <input type="text" id="filter-session" placeholder="1x02">
              <label for="filter-since">Desde</label>
              <input type="date" id="filter-since">
              <label for="filter-unread" class="checkbox-inline">
                <input type="checkbox" id="filter-unread">
                No leídos
              </label>
              <button type="button" id="filter-apply">Aplicar Filtros</button>
            </div>
                    <div id="message-feed" class="message-feed"></div>
                  </div>
                </div>
              </div>
              <div class="workspace-view dm-view" data-view="poi">
                <section class="panel-section dm-only" id="poi-form-section">
                  <div class="blade-section-header">
                    <h3 id="poi-form-title">Crear PdI</h3>
                    <button type="button" id="poi-cancel" class="ghost small">Reiniciar</button>
                  </div>
                  <div class="blade-form-body">
                    <form id="poi-form">
                      <input type="hidden" id="poi-id">
                      <label for="poi-name">Nombre</label>
                      <input type="text" id="poi-name" required="">

                      <label for="poi-category">Categoría</label>
                      <select id="poi-category" required=""><option value="OV_BASE">Base OV</option><option value="CRIME_SCENE">Escena del Crimen</option><option value="ESOTERROR_CELL">Célula Esoterrorista</option><option value="MUNDANE_TOWN">Pueblo Mundano</option><option value="INDUSTRIAL_SITE">Sitio Industrial</option><option value="NATURAL_SITE">Sitio Natural</option><option value="NPC">PNJ Clave</option><option value="RUMOR">Rumor</option></select>

                      <div class="coord-row">
                        <div>
                          <label for="poi-latitude">Latitud</label>
                          <input type="number" step="0.000001" id="poi-latitude" required="">
                        </div>
                        <div>
                          <label for="poi-longitude">Longitud</label>
                          <input type="number" step="0.000001" id="poi-longitude" required="">
                        </div>
                      </div>
                      <button type="button" id="pick-location">Elegir del mapa</button>

                      <label for="poi-image-url">URL de imagen (opcional)</label>
                      <input type="url" id="poi-image-url" placeholder="https://...">

                      <label for="poi-threat">Nivel de amenaza (1-5)</label>
                      <input type="number" id="poi-threat" min="1" max="5" required="">

                      <label for="poi-veil">Estado del velo</label>
                      <select id="poi-veil" required="">
                        <option value="intact">Intacto</option>
                        <option value="frayed">Deshilachado</option>
                        <option value="torn">Roto</option>
                      </select>

                      <label for="poi-session">Etiqueta de sesión</label>
                      <input type="text" id="poi-session" placeholder="1x02">

                      <label for="poi-public-note">Nota pública</label>
                      <textarea id="poi-public-note"></textarea>

                      <label for="poi-dm-note">Nota para el DJ</label>
                      <textarea id="poi-dm-note"></textarea>

                      <div class="form-actions">
                        <button type="submit" id="poi-submit">Crear PdI</button>
                      </div>
                    </form>
                  </div>
                </section>
              </div>
              <div class="workspace-view dm-view" data-view="mission">
                <div class="mission-editor">
                  <div class="mission-editor-header">
                    <div class="dm-form-title">CONTROL DE MISIÓN</div>
                  </div>
                  <label for="mission-editor-input">Notas de Misión</label>
                  <textarea id="mission-editor-input" rows="8" placeholder="Esboza objetivos, amenazas, inteligencia..."></textarea>
                  <div class="form-actions">
                    <button type="button" id="mission-save">Guardar Informe de Misión</button>
                  </div>
                </div>
              </div>
              <div class="workspace-view dm-view" data-view="dossiers">
                <div id="dm-entities-layout" class="dm-entities-layout">
                  <div class="dm-entities-top">
                    <div class="dm-entities-map" id="dm-entities-map"></div>
                    <div class="dm-entities-list">
                      <div class="dossier-controls">
                        <div class="dossier-filter-group">
                          <button type="button" class="small ghost dm-filter-type" data-type="">Todos</button>
                          <button type="button" class="small ghost dm-filter-type" data-type="pc">PJ</button>
                          <button type="button" class="small ghost dm-filter-type" data-type="npc">PNJ</button>
                          <button type="button" class="small ghost dm-filter-type" data-type="org">Orgs</button>
                        </div>
                        <input type="search" id="dm-entity-search" placeholder="Buscar por nombre o rol">
                      </div>
                      <div class="dossier-list" id="dm-entity-list"></div>
                    </div>
                    <div class="dm-entities-context" id="dm-entities-context">
                      <div class="dossier-detail">Selecciona una entidad para ver contexto.</div>
                    </div>
                  </div>
                  <div class="dm-entities-bottom">
                    <div class="dm-entities-detail" id="dm-entities-detail">
                      <div class="dossier-admin-header">
                        <div>
                          <div class="dm-form-title">Dossier editable</div>
                          <p class="text-xs muted">Actualiza identidad, actividad y control de visibilidad.</p>
                        </div>
                        <button type="button" id="entity-reset" class="ghost small">Reiniciar</button>
                      </div>
                      <form id="entity-form" class="entity-form">
                        <input type="hidden" id="entity-id">
                        <div class="dossier-detail-grid">
                          <div class="dossier-col">
                            <div class="form-section">
                              <div class="section-title">Identidad</div>
                              <label for="entity-type">Tipo</label>
                              <select id="entity-type" required="">
                                <option value="pc">PJ</option>
                                <option value="npc">PNJ</option>
                                <option value="org">Organización</option>
                              </select>
                              <label for="entity-code-name">Code name / callsign</label>
                              <input type="text" id="entity-code-name" required="">
                              <label for="entity-real-name">Nombre real</label>
                              <input type="text" id="entity-real-name">
                              <label for="entity-role">Rol / función</label>
                              <input type="text" id="entity-role">
                            </div>
                            <div class="form-section">
                              <div class="section-title">Estado y afinidad</div>
                              <label for="entity-status">Estado</label>
                              <input type="text" id="entity-status" placeholder="activo, desaparecido...">
                              <label for="entity-alignment">Alineación</label>
                              <input type="text" id="entity-alignment" placeholder="ordo_veritatis, esoterror...">
                              <label for="entity-threat">Nivel de amenaza</label>
                              <input type="number" id="entity-threat" min="1" max="5">
                              <label for="entity-image">URL de imagen</label>
                              <input type="url" id="entity-image" placeholder="https://...">
                            </div>
                            <div class="form-section">
                              <div class="section-title">Actividad</div>
                              <div class="coord-row">
                                <div>
                                  <label for="entity-session-first">Primera sesión</label>
                                  <input type="text" id="entity-session-first" placeholder="1x00">
                                </div>
                                <div>
                                  <label for="entity-session-last">Última sesión</label>
                                  <input type="text" id="entity-session-last" placeholder="1x03">
                                </div>
                              </div>
                              <label for="entity-sessions">Sesiones (coma)</label>
                              <input type="text" id="entity-sessions" placeholder="1x00,1x01">
                              <label for="entity-pois">PdIs vinculados (id:rol:sesión)</label>
                              <input type="text" id="entity-pois" placeholder="3:Vigía:1x02">
                              <label for="entity-links">Conexiones (id:relación)</label>
                              <input type="text" id="entity-links" placeholder="6:Aliado,7:Enemigo">
                            </div>
                          </div>
                          <div class="dossier-col">
                            <div class="form-section">
                              <div class="section-title">Intel</div>
                              <label for="entity-public-note">Resumen público</label>
                              <textarea id="entity-public-note" rows="4"></textarea>
                              <label for="entity-dm-note">Notas DM</label>
                              <textarea id="entity-dm-note" rows="6"></textarea>
                            </div>
                            <div class="form-section">
                              <div class="section-title">Control de visibilidad</div>
                              <label for="entity-visibility">Visibilidad</label>
                              <select id="entity-visibility">
                                <option value="agent_public">Visible para agentes</option>
                                <option value="locked">Bloqueada (requiere clave)</option>
                                <option value="dm_only">Solo DM</option>
                              </select>
                              <label for="entity-unlock">Código de desbloqueo</label>
                              <input type="text" id="entity-unlock">
                              <label for="entity-locked-hint">Pista de desbloqueo</label>
                              <input type="text" id="entity-locked-hint" placeholder="Pista breve">
                              <label class="checkbox-inline">
                                <input type="checkbox" id="entity-archived"> Archivada
                              </label>
                              <div class="form-actions">
                                <button type="submit" id="entity-submit">Guardar dossier</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </section>
        </div>
      </main>
      <nav class="mobile-nav" id="mobile-nav">
        <button type="button" class="mobile-tab active" data-mobile-tab="map">Mapa</button>
        <button type="button" class="mobile-tab" data-mobile-tab="pois">PdI</button>
        <button type="button" class="mobile-tab" data-mobile-tab="console">Consola</button>
      </nav>
      <footer class="app-footer">
        <div class="footer-status">
          <span id="footer-membrane-status">ESTABILIDAD DE MEMBRANA: 92%</span>
          <span id="footer-time">PA HORA --:--</span>
        </div>
      </footer>
      <div id="debug-panel" class="debug-panel hidden"></div>
      <div id="inbox-overlay" class="inbox-overlay hidden">
        <div class="inbox-panel">
          <header class="inbox-header">
            <div>
              <div class="inbox-title">BANDEJA DE ENTRADA RETRO</div>
              <div class="inbox-subtitle">Despachos de Integridad de Membrana Activa</div>
            </div>
            <button id="inbox-close" class="ghost small">Cerrar</button>
          </header>
          <div id="inbox-messages" class="inbox-messages"></div>
        </div>
      </div>
    </div>

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <script src="app.js" type="module"></script>
  

</body></html>
