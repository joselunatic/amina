<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#03140c" />
  <title>AMINA // Análisis de Misiones e Investigación de Nuevas Amenazas</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/AMINA.png" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <link
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="styles.css" />
</head>

<body class="crt booting">
  <div id="boot-screen" class="boot-screen active">
    <div class="boot-monitor">
      <div class="boot-frame">
        <div class="boot-crt">
          <div class="boot-scanline"></div>
          <pre id="boot-output"></pre>
        </div>
      </div>
      <div class="boot-console">
        <div class="boot-console-header">
          <span>AMINA // ANÁLISIS DE MISIONES E INVESTIGACIÓN DE NUEVAS AMENAZAS</span>
          <span>DIV. DE OPERACIONES DE MEMBRANA</span>
        </div>
        <div class="boot-console-body">
          <div id="boot-menu" class="boot-menu">
            <button id="boot-player">CANAL DE AGENTE DE CAMPO</button>
            <button id="boot-dm">ACCESO SR. VERDAD</button>
          </div>
          <div id="agent-login" class="agent-login hidden">
            <form id="agent-login-form" class="agent-login-form">
              <label for="agent-select">Agente</label>
              <select id="agent-select"></select>
              <label for="agent-pass">Contraseña de Agente</label>
              <input type="password" id="agent-pass" autocomplete="off" />
              <button type="button" id="agent-login-button">Autorizar</button>
              <button type="button" id="agent-password-toggle" class="ghost small">Configurar contraseña</button>
              <p id="agent-login-status" class="boot-status"></p>
            </form>
            <form id="agent-password-panel" class="agent-password-panel hidden">
              <div id="agent-pass-current-wrap">
                <label for="agent-pass-current">Contraseña actual</label>
                <input type="password" id="agent-pass-current" autocomplete="off" />
              </div>
              <label for="agent-pass-new">Nueva contraseña</label>
              <input type="password" id="agent-pass-new" autocomplete="off" />
              <label for="agent-pass-confirm">Confirmar contraseña</label>
              <input type="password" id="agent-pass-confirm" autocomplete="off" />
              <div class="boot-actions">
                <button type="button" id="agent-pass-save">Guardar</button>
                <button type="button" id="agent-pass-cancel">Cancelar</button>
              </div>
              <p id="agent-pass-status" class="boot-status"></p>
            </form>
          </div>
          <div id="command-menu" class="command-menu hidden text-left">
            <div class="command-header">INTERFAZ DE COMANDOS</div>
            <div id="command-log" class="command-log text-xs italic">
              listo // escriba MOSTRAR MAPA AMINA o MOSTRAR BANDEJA DE ENTRADA
            </div>
            <input id="command-input" type="text" class="command-input" value="MOSTRAR MAPA AMINA" aria-label="Comando" placeholder="Escribe un comando" />
            <div class="command-actions">
              <button type="button" id="command-map">MOSTRAR MAPA AMINA</button>
              <button type="button" id="command-inbox">MOSTRAR BANDEJA DE ENTRADA</button>
            </div>
          </div>
          <form id="boot-dm-form" class="boot-dm-form">
            <label for="boot-dm-secret">CÓDIGO DE ACCESO SR. VERDAD</label>
            <input type="password" id="boot-dm-secret" autocomplete="off" />
            <div class="boot-actions">
              <button type="submit">ACCEDER</button>
              <button type="button" id="boot-cancel">CANCELAR</button>
            </div>
            <p id="boot-status" class="boot-status"></p>
          </form>
          <button type="button" id="boot-dm-change" class="ghost small">Configurar contraseña</button>
          <form id="boot-dm-password-panel" class="boot-dm-password hidden">
            <div id="boot-dm-current-wrap">
              <label for="boot-dm-current">Contraseña actual</label>
              <input type="password" id="boot-dm-current" autocomplete="off" />
            </div>
            <label for="boot-dm-new">Nueva contraseña</label>
            <input type="password" id="boot-dm-new" autocomplete="off" />
            <label for="boot-dm-confirm">Confirmar contraseña</label>
            <input type="password" id="boot-dm-confirm" autocomplete="off" />
            <div class="boot-actions">
              <button type="button" id="boot-dm-save">Guardar</button>
              <button type="button" id="boot-dm-cancel">Cancelar</button>
            </div>
            <p id="boot-dm-pass-status" class="boot-status"></p>
          </form>
        </div>
      </div>
    </div>
    <div id="entity-delete-overlay" class="entity-delete-overlay hidden">
      <div class="entity-delete-panel">
        <header class="entity-delete-header">
          <div>
            <h3>Confirmar eliminación</h3>
            <p class="muted">Esta acción no se puede deshacer.</p>
          </div>
          <button type="button" id="entity-delete-close" class="ghost small">Cerrar</button>
        </header>
        <p id="entity-delete-message">¿Estás seguro de eliminar esta entidad?</p>
        <div class="form-actions">
          <button type="button" id="entity-delete-confirm" class="danger">Eliminar</button>
          <button type="button" id="entity-delete-cancel" class="ghost small">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
  <div class="crt-screen">
    <div class="crt-scanline" aria-hidden="true"></div>
    <header class="amina-topbar">
      <div class="top-ticker">
        <span class="top-ticker-label">FEED GLOBAL OV</span>
        <div class="top-ticker-track">
          <div id="ticker-track">
            <span class="ticker-placeholder">Esperando despachos de membrana…</span>
          </div>
        </div>
        <button id="logout-button" class="logout-button" aria-label="Cambiar el modo de sesión">
          <svg class="power-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M12 3v8m5.657-5.657a8 8 0 1 1-11.314 0"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </button>
      </div>
    </header>
    <main class="app-shell">
      <div class="app-layout no-sidebar">
        <section class="main-column" id="main-column">
          <div class="view-top">
            <div class="view-left">
              <div class="map-shell">
                <section class="map-panel" id="map-panel">
                  <div id="map"></div>
                  <div class="map-style-switch">
                    <button type="button" data-style="config-default" class="ghost small">Base</button>
                    <button type="button" data-style="mapbox://styles/mapbox-map-design/ck4014y110wt61ctt07egsel6"
                      class="ghost small">Decimal</button>
                  </div>
                  <div class="map-filters" id="map-filters"></div>
                  <div id="message-bar"></div>
                  <div class="brand-watermark">AMINA / Monitor de integridad de la Membrana</div>
                </section>
              </div>
              <section class="console-card poi-list-card agent-only" id="poi-list-shell">
                <div class="card-title">Puntos de Interés</div>
                <input type="search" id="poi-search" class="poi-search"
                  placeholder="Buscar PdI por nombre, sesión o nota" />
                <ul id="poi-list" class="poi-list-inline"></ul>
              </section>
            </div>
            <div class="view-right">
              <div class="workspace-top agent-top" data-view="map">
                <div class="console-card focal-card" id="focal-poi-card">
                  <div class="card-title">PDI FOCAL</div>
                  <div class="console-card-body" id="focal-poi-content">Ningún PdI seleccionado. Elige uno del mapa o de
                    la lista.</div>
                </div>
              </div>
              <div class="workspace-top agent-top" data-view="console">
                <div class="console-card chat-terminal-card" id="agent-chat-card">
                  <div class="card-title">TERMINAL DE MENSAJERIA <span id="chat-unread-badge-agent" class="badge-unread-count hidden" aria-live="polite"></span></div>
                  <div class="chat-terminal" data-variant="agent">
                    <div class="chat-terminal-header">
                      <div class="chat-terminal-status">
                        <span id="chat-agent-label">Agente: --</span>
                        <span id="chat-identity-label">Identidad: --</span>
                      </div>
                      <button type="button" class="ghost small" id="chat-sync">Sincronizar</button>
                    </div>
                    <div class="chat-terminal-body">
                      <div class="chat-thread-list" id="chat-identity-list"></div>
                      <div class="chat-terminal-screen">
                        <div class="chat-terminal-output" id="chat-transcript"></div>
                        <div class="chat-terminal-scanline"></div>
                      </div>
                    </div>
                    <form class="chat-terminal-input" id="chat-form">
                      <input type="text" id="chat-input" placeholder="Escribe un mensaje..." autocomplete="off" />
                      <button type="submit">Enviar</button>
                    </form>
                  </div>
                </div>
              </div>
              <div class="workspace-top agent-top" data-view="database">
                <div class="dm-entities-top agent-entities-top">
                  <div class="console-card dm-entity-detail-card" id="agent-entity-detail-card">
                    <div class="card-title">Detalle de entidad</div>
                    <div class="agent-dossier-tabs">
                      <button type="button" class="agent-dossier-tab active" data-agent-dossier-tab="dossier">Dossier</button>
                      <button type="button" class="agent-dossier-tab" data-agent-dossier-tab="notes">Notas agentes</button>
                    </div>
                    <div class="agent-dossier-panels">
                      <div class="agent-dossier-panel active" data-agent-dossier-panel="dossier">
                        <div class="dm-entity-detail-body">
                          <div class="dm-entity-detail-grid">
                            <div class="dm-entity-map-container">
                              <div id="agent-entity-detail-map" class="dm-entities-map" role="img" aria-label="Mapa de entidad"></div>
                            </div>
                            <div class="dm-entity-detail-pane">
                              <div class="dm-detail-badge-row"></div>
                              <div class="dossier-detail" id="dossier-detail">Selecciona una entidad para ver su dossier.</div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="agent-dossier-panel" data-agent-dossier-panel="notes">
                        <div class="agent-notes-empty">Selecciona una entidad para ver notas de agente.</div>
                      </div>
                    </div>
                  </div>
                  <div class="dm-entity-hero-stack">
                    <div class="console-card dm-entity-hero-card" id="agent-entity-hero-card">
                      <div class="dm-entity-hero-body muted">Sin imagen disponible.</div>
                    </div>
                    <div class="console-card bestiary-card" id="agent-bestiary-card" data-variant="agent">
                      <div class="bestiary-folder">
                        <div class="bestiary-tab">
                          <span class="bestiary-logo">ORDO</span>
                          <span class="bestiary-code" id="agent-bestiary-code" data-bestiary-code>OV-ESK-XXX</span>
                        </div>
                        <div class="bestiary-body">
                          <div class="bestiary-visual">
                            <div class="bestiary-photo-frame">
                              <img id="agent-bestiary-image" data-bestiary-image src="/creature.png" alt="Bestiary portrait" />
                              <div class="bestiary-photo-overlay"></div>
                              <div class="bestiary-photo-band"></div>
                            </div>
                            <div class="bestiary-meta">
                              <div class="bestiary-callsign" id="agent-bestiary-callsign" data-bestiary-callsign>Selecciona un dossier</div>
                              <div class="bestiary-line" id="agent-bestiary-classification" data-bestiary-classification>Clasificación: —</div>
                              <div class="bestiary-line" id="agent-bestiary-threat" data-bestiary-threat>Nivel de amenaza: ?</div>
                              <div class="bestiary-line" id="agent-bestiary-status" data-bestiary-status>Estado: —</div>
                              <div class="bestiary-line" id="agent-bestiary-alignment" data-bestiary-alignment>Alineación: —</div>
                            </div>
                          </div>
                          <div class="bestiary-section">
                            <div class="bestiary-section-title">Resumen público</div>
                            <p id="agent-bestiary-summary" data-bestiary-summary class="muted">Sin entidad seleccionada.</p>
                          </div>
                          <div class="bestiary-section bestiary-dm-only">
                            <div class="bestiary-section-title">Comportamiento observado</div>
                            <p id="agent-bestiary-behaviour" data-bestiary-behaviour>—</p>
                          </div>
                          <div class="bestiary-section bestiary-dm-only">
                            <div class="bestiary-section-title">Origen</div>
                            <p id="agent-bestiary-origin" data-bestiary-origin>—</p>
                          </div>
                          <div class="bestiary-section">
                            <div class="bestiary-section-title">MEL (medidas especiales de liquidación)</div>
                            <ul id="agent-bestiary-mel" data-bestiary-mel class="bestiary-protocols">
                              <li>Sin MEL registradas.</li>
                            </ul>
                          </div>
                          <div class="bestiary-section bestiary-dm-only">
                            <div class="bestiary-section-title">Protocolos</div>
                            <ul id="agent-bestiary-protocols" data-bestiary-protocols class="bestiary-protocols">
                              <li>Sin protocolos registrados.</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="workspace-top base-top" data-view="base">
                <div class="base3d-root" id="base3d-root">
                  <canvas id="base3d-canvas"></canvas>
                  <svg class="base-focus-link" id="base-focus-link" viewBox="0 0 100 100" preserveAspectRatio="none">
                    <polyline points="0,0 0,0 0,0"></polyline>
                  </svg>
                  <div class="base3d-hud-overlay" id="base3d-hud-overlay">
                    <div class="base3d-controls">
                      <button type="button" class="base-reset-camera" id="base-reset-camera" aria-label="Resetear camara">
                        R
                      </button>
                      <button type="button" class="base-fullscreen-toggle" id="base-fullscreen-toggle" aria-label="Alternar pantalla completa">
                        Pantalla completa
                      </button>
                    </div>
                    <div class="console-card base-focus-card" id="base-focus-card">
                      <div class="card-title">FOCO DE ZONA</div>
                      <div class="console-card-body base-focus-body">
                        <div class="base-zone-name" id="base-zone-name">COMANDO</div>
                        <div class="base-zone-status" id="base-zone-status">
                          <span class="badge-soft base-status-pill" data-status="tag">CENTRAL</span>
                        </div>
                        <div class="base-zone-module is-hidden" id="base-zone-module"></div>
                        <div class="base-zone-note" id="base-zone-note">SINCRONIA DE SISTEMA EN LINEA.</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <nav class="workspace-nav primary-nav" aria-label="Modo de consola">
            <div class="workspace-tabs agent-tabs">
              <button type="button" class="workspace-tab active" data-view="map">Mapa</button>
              <button type="button" class="workspace-tab" data-view="console">Consola</button>
              <button type="button" class="workspace-tab" data-view="sheet">Ficha</button>
              <button type="button" class="workspace-tab" data-view="database">Base de Datos</button>
              <button type="button" class="workspace-tab" data-view="base">ENTROPIA</button>
              <button type="button" class="workspace-tab" data-view="relations">Relaciones</button>
            </div>
            <div class="workspace-tabs dm-tabs">
              <button type="button" class="workspace-tab active" data-view="map">Mapa</button>
              <button type="button" class="workspace-tab" data-view="journal">Journal</button>
              <button type="button" class="workspace-tab" data-view="entities">Entidades</button>
              <button type="button" class="workspace-tab" data-view="base">ENTROPIA</button>
              <button type="button" class="workspace-tab" data-view="relations">Relaciones</button>
            </div>
          </nav>

          <section class="workspace" id="workspace">
            <section class="activity-panel activity-panel--workspace" id="activity-panel" aria-live="polite">
              <div class="activity-header">
                <div class="activity-title">Registro de actividad</div>
                <div class="activity-subtitle" id="activity-status">Esperando sesión...</div>
                <div class="activity-connection" id="activity-connection">Ultima conexion con mainframe: —</div>
              </div>
              <ul class="activity-list" id="activity-list"></ul>
              <div class="activity-footer">
                <button type="button" id="activity-more" class="ghost small">Cargar mas</button>
              </div>
            </section>
            <div class="workspace-view agent-view active" data-view="map">
              <div class="console-stack"></div>
            </div>
              <div class="workspace-view agent-view" data-view="console">
                <div class="console-stack">
                  <div class="console-card mission-card" id="mission-brief-card">
                    <div class="card-title">INFORME DE MISIÓN</div>
                    <div class="console-card-body">
                      <div class="inline-fields">
                        <div class="flex-row gap-sm">
                          <div class="flex-col equal">
                            <label for="agent-journal-season">Temporada</label>
                            <input type="number" id="agent-journal-season" min="1" max="20" value="2" />
                          </div>
                          <div class="flex-col equal">
                            <label for="agent-journal-session">Sesión</label>
                            <input type="number" id="agent-journal-session" min="0" max="99" value="0" />
                          </div>
                        </div>
                      </div>
                      <div class="field-label" id="agent-journal-public-label">Notas de misión (agente)</div>
                      <div
                        id="agent-journal-public"
                        class="mission-notes"
                        role="textbox"
                        aria-labelledby="agent-journal-public-label"
                        aria-multiline="true"
                        aria-readonly="true"
                        contenteditable="false"
                      >Esperando directivas.</div>
                      <div class="form-actions">
                        <button type="button" id="agent-journal-save" class="ghost">Editar</button>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <div class="workspace-view agent-view" data-view="sheet">
              <div class="console-stack character-sheet-stack">
                <div class="console-card character-sheet-card" id="character-sheet-card">
                  <div class="card-title">FICHA DE PERSONAJE</div>
                  <div class="console-card-body character-sheet-body">
                    <div class="sheet-header">
                      <div class="sheet-header-main">
                        <div class="sheet-name" id="sheet-character-name">—</div>
                        <div class="sheet-role" id="sheet-character-role"></div>
                      </div>
                      <div class="sheet-status-pill" id="sheet-save-state" data-state="idle">sin cambios</div>
                    </div>
                    <div class="sheet-overview">
                      <div class="sheet-metrics">
                        <div class="sheet-metric">
                          <div class="metric-label">Salud</div>
                          <div class="metric-controls">
                            <button type="button" class="metric-btn" data-sheet-adjust="health" data-delta="-1" aria-label="Restar salud">-</button>
                            <span class="metric-current" id="sheet-health-current">0</span>
                            <span class="metric-max">/ <span id="sheet-health-max">0</span></span>
                            <button type="button" class="metric-btn" data-sheet-adjust="health" data-delta="1" aria-label="Sumar salud">+</button>
                          </div>
                        </div>
                        <div class="sheet-metric">
                          <div class="metric-label">Estabilidad</div>
                          <div class="metric-controls">
                            <button type="button" class="metric-btn" data-sheet-adjust="stability" data-delta="-1" aria-label="Restar estabilidad">-</button>
                            <span class="metric-current" id="sheet-stability-current">0</span>
                            <span class="metric-max">/ <span id="sheet-stability-max">0</span></span>
                            <button type="button" class="metric-btn" data-sheet-adjust="stability" data-delta="1" aria-label="Sumar estabilidad">+</button>
                          </div>
                        </div>
                      </div>
                      <div class="sheet-summary">
                        <div class="summary-row">
                          <span>Generales disponibles</span>
                          <strong id="sheet-general-total">0</strong>
                        </div>
                        <div class="summary-row">
                          <span>Investigación disponible</span>
                          <strong id="sheet-investigation-total">0</strong>
                        </div>
                      </div>
                    </div>
                    <div class="sheet-refresh">
                      <button type="button" class="ghost" id="sheet-refresh">Refrescar reservas</button>
                      <span class="sheet-refresh-note">Restaura las reservas al máximo permitido.</span>
                    </div>
                    <div class="sheet-section">
                      <div class="sheet-section-title">Habilidades Generales</div>
                      <div class="sheet-section-hint">Gasto táctico inmediato para modificar 1d6.</div>
                      <div class="sheet-skill-list" id="sheet-general-list"></div>
                      <details class="sheet-collapse" id="sheet-general-collapse">
                        <summary>Más habilidades</summary>
                        <div class="sheet-skill-list" id="sheet-general-extra"></div>
                      </details>
                    </div>
                    <div class="sheet-section">
                      <div class="sheet-section-title">Habilidades de Investigación</div>
                      <div class="sheet-section-hint">Consumibles de conocimiento para efectos automáticos.</div>
                      <div class="sheet-investigation" id="sheet-investigation-list"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="workspace-view agent-view" data-view="database">
              <div class="database-stack">
                <div class="console-card dossier-card" id="dossier-card">
                  <div class="card-title">Selector de entidades</div>
                  <div class="dossier-controls">
                    <div class="dossier-filter-group">
                      <button type="button" class="small ghost dossier-type" data-dossier-type="">Todos</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="pc">PJ</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="npc">PNJ</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="org">Orgs</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="poi">PdI</button>
                      <button type="button" class="small ghost dossier-type" data-dossier-type="criatura">EOE</button>
                    </div>
                    <input type="search" id="dossier-search" placeholder="Buscar nombre o callsign" />
                  </div>
                  <div class="dossier-layout">
                    <div class="dossier-list" id="dossier-list"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="workspace-view base-view" data-view="base">
              <div class="base-stack">
                <div class="console-card base-detail-card" id="base-detail-card">
                  <div class="card-title">DETALLE DE ZONA</div>
                  <div class="console-card-body base-detail-body">
                    <div class="base-style-controls">
                      <div class="base-style-control">
                        <label for="base-visual-mode">Estilo</label>
                        <select id="base-visual-mode">
                          <option value="subtle">Sutil</option>
                          <option value="technical">Tecnico</option>
                          <option value="dramatic">Dramatico</option>
                        </select>
                      </div>
                      <div class="base-style-control">
                        <label for="base-visual-palette">Paleta</label>
                        <select id="base-visual-palette">
                          <option value="standard">Estandar</option>
                          <option value="amber">Acento ambar</option>
                        </select>
                      </div>
                    </div>
                    <div class="base-detail-title" id="base-detail-title">CMD-01 COMANDO</div>
                    <div class="base-detail-grid">
                      <div class="base-detail-row">
                        <span class="base-detail-label">MODULOS</span>
                        <span class="base-detail-value" id="base-detail-status">0</span>
                      </div>
                      <div class="base-detail-row">
                        <span class="base-detail-label">DISPONIBLES</span>
                        <span class="base-detail-value" id="base-detail-event">0</span>
                      </div>
                      <div class="base-detail-row">
                        <span class="base-detail-label">BLOQUEADOS</span>
                        <span class="base-detail-value" id="base-detail-access">0</span>
                      </div>
                      <div class="base-detail-notes">
                        <div class="base-detail-label">RESUMEN</div>
                        <div class="base-detail-notes-text" id="base-detail-notes">Sin incidencias. Flujo estable.</div>
                      </div>
                    </div>
                    <div class="base-activity">
                      <div class="base-activity-title">Modulos</div>
                      <ul class="base-activity-list" id="base-activity-list"></ul>
                    </div>
                    <div class="base-editor" id="base-editor">
                      <div class="base-editor-header">
                        <div class="base-editor-title">Edicion rapida</div>
                        <button type="button" class="ghost" id="base-editor-toggle">Editar zona</button>
                      </div>
                      <div class="base-editor-body hidden" id="base-editor-body">
                        <textarea id="base-editor-text" rows="10" spellcheck="false" aria-label="Editor JSON de zona" placeholder="Pega o edita el JSON de la zona"></textarea>
                        <div class="base-editor-actions">
                          <button type="button" class="ghost" id="base-editor-cancel">Cancelar</button>
                          <button type="button" id="base-editor-save">Guardar</button>
                        </div>
                        <div class="base-editor-hint">JSON de zona (modules/items). Guardado completo.</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="workspace-view agent-view" data-view="relations">
              <div class="console-stack">
                  <div class="console-card" id="agent-relations-card">
                    <div class="card-title">Relaciones</div>
                  <div class="dm-graph-toolbar">
                    <div class="dm-graph-search">
                      <label for="agent-graph-search">Entidad</label>
                      <input type="search" id="agent-graph-search" placeholder="Nombre o callsign…" autocomplete="off" />
                      <div class="multi-suggestions" id="agent-graph-suggestions"></div>
                    </div>
                    <div class="graph-selection" id="agent-graph-selection">
                      <div class="graph-selection-actions">
                        <button type="button" class="ghost small" id="agent-graph-add">Añadir grafo</button>
                        <button type="button" class="ghost small" id="agent-graph-clear">Limpiar</button>
                      </div>
                      <div class="multi-chips" id="agent-graph-chips"></div>
                    </div>
                    <button type="button" class="ghost small graph-fullscreen-btn" id="agent-graph-fullscreen">
                      Pantalla completa
                    </button>
                  </div>
                  <div id="agent-graph" class="entity-graph-panel">Selecciona una entidad para ver sus vínculos.</div>
                  <div class="graph-entity-summary" id="agent-graph-summary">Toca un nodo para ver detalles.</div>
                </div>
              </div>
            </div>
            <div class="workspace-view dm-view" data-view="map">
              <div class="console-stack">
                <div class="console-card focal-card" id="dm-focal-poi-card">
                  <div class="card-title">PDI FOCAL (DM)</div>
                  <div class="console-card-body" id="dm-focal-poi-content">Selecciona un PdI en el mapa o la lista.
                  </div>
                </div>
                <div class="console-card mission-card" id="dm-map-context-card">
                  <div class="card-title">Contexto</div>
                  <div class="console-card-body" id="dm-map-context">Mapa operativo activo.</div>
                </div>
              </div>
            </div>
            <div class="workspace-view dm-view" data-view="journal">
              <div class="dm-journal-grid">
                <div class="dm-mobile-console-tabs" role="tablist" aria-label="Consola DM">
                  <button type="button" class="dm-mobile-console-tab active" data-dm-console-tab="messages">Mensajería</button>
                  <button type="button" class="dm-mobile-console-tab" data-dm-console-tab="journal">Journal</button>
                </div>
                <div class="dm-console-panel" data-dm-console-panel="messages">
                  <div class="console-card inbox-card" id="dm-chat-card">
                    <div class="card-title">
                      Mensajería táctica
                      <span id="dm-chat-session-status" class="status-pill" data-status="idle">Sin sesión</span>
                      <span id="chat-unread-badge-dm" class="badge-unread-count hidden" aria-live="polite"></span>
                    </div>
                    <div class="dm-chat-grid">
                      <div class="dm-chat-sidebar">
                        <div class="dm-chat-controls">
                          <label for="dm-chat-agent">Agente</label>
                          <select id="dm-chat-agent"></select>
                          <label for="dm-chat-identity">Identidad</label>
                          <select id="dm-chat-identity"></select>
                          <button type="button" id="dm-chat-open" class="ghost">Abrir sesión</button>
                        </div>
                        <div class="dm-chat-threads" id="dm-chat-thread-list"></div>
                        <div class="dm-identity-manager collapsible">
                          <button type="button" class="collapsible-toggle">
                            <span>Identidades DM</span>
                            <span class="collapsible-icon">+</span>
                          </button>
                          <div class="collapsible-body collapsed">
                            <div id="dm-identity-list" class="dm-identity-list"></div>
                            <form id="dm-identity-form" class="dm-identity-form">
                              <input type="text" id="dm-identity-name" placeholder="Nueva identidad..." autocomplete="off" />
                              <div class="form-actions">
                                <button type="submit" id="dm-identity-save">Guardar</button>
                                <button type="button" id="dm-identity-cancel" class="ghost small">Cancelar</button>
                              </div>
                            </form>
                          </div>
                        </div>
                      </div>
                      <div class="dm-chat-main">
                        <div class="chat-terminal" data-variant="dm">
                          <div class="chat-terminal-header">
                            <div class="chat-terminal-status">
                              <span id="dm-chat-active-label">Selecciona un par agente/identidad.</span>
                            </div>
                            <button type="button" class="ghost small" id="dm-chat-refresh">Sincronizar</button>
                          </div>
                          <div class="chat-terminal-body">
                            <div class="chat-terminal-screen full">
                              <div class="chat-terminal-output" id="dm-chat-transcript"></div>
                              <div class="chat-terminal-scanline"></div>
                            </div>
                          </div>
                          <form class="chat-terminal-input" id="dm-chat-form">
                            <input type="text" id="dm-chat-input" placeholder="Responder..." autocomplete="off" />
                            <button type="submit">Enviar</button>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <nav class="workspace-nav journal-nav dm-only" aria-label="Modo de consola">
                  <div class="workspace-tabs dm-tabs">
                    <button type="button" class="workspace-tab" data-view="map">Mapa</button>
                    <button type="button" class="workspace-tab active" data-view="journal">Journal</button>
                    <button type="button" class="workspace-tab" data-view="entities">Entidades</button>
                    <button type="button" class="workspace-tab" data-view="relations">Relaciones</button>
                  </div>
                </nav>
                <div class="dm-console-panel" data-dm-console-panel="journal">
                  <div class="console-card mission-card">
                    <div class="card-title">
                      Journal de sesión
                      <span id="dm-journal-status" class="status-pill" data-status="clean">Sin cambios</span>
                    </div>
                    <div class="inline-fields">
                      <div class="flex-row gap-sm">
                        <div class="flex-col equal">
                          <label for="journal-season">Temporada</label>
                          <input type="number" id="journal-season" min="1" max="20" value="2" />
                        </div>
                        <div class="flex-col equal">
                          <label for="journal-session">Sesión</label>
                          <input type="number" id="journal-session" min="0" max="99" value="0" />
                        </div>
                      </div>
                    </div>
                    <label for="journal-public">Resumen para agentes</label>
                    <textarea id="journal-public" rows="4"
                      placeholder="Breve resumen visible para agentes en Base de Datos."></textarea>
                    <label for="journal-dm">Notas del DJ</label>
                    <textarea id="journal-dm" rows="6" placeholder="Notas privadas del DJ para esta sesión."></textarea>
                    <div class="form-actions">
                      <button type="button" id="journal-save">Guardar Journal</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="workspace-view dm-view" data-view="entities">
              <div class="dm-entities-top">
                <div class="console-card dm-entity-detail-card" id="dm-entity-detail-card">
                  <div class="card-title">Detalle de entidad</div>
                  <div class="dm-entity-detail-body">
                    <div class="dm-entity-detail-grid">
                      <div class="dm-entity-map-container">
                        <div id="dm-entity-detail-map" class="dm-entities-map" aria-label="Mapa de entidad"></div>
                      </div>
                      <div class="dm-entity-detail-pane">
                        <div class="dm-detail-badge-row"></div>
                        <div class="dm-detail-notes">Selecciona un dossier para ver su ficha.</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="dm-entity-hero-stack">
                  <div class="console-card dm-entity-hero-card" id="dm-entity-hero-card">
                    <div class="dm-entity-hero-visual" id="dm-entity-hero-visual">
                      <div class="dm-entity-hero-body muted" id="dm-entity-hero-placeholder">Sin imagen disponible.</div>
                    </div>
                    <div class="bestiary-card hidden" id="dm-bestiary-card" data-variant="dm" data-empty="true">
                      <div class="bestiary-folder">
                        <div class="bestiary-tab">
                          <span class="bestiary-logo">ORDO</span>
                          <span class="bestiary-code" id="bestiary-code" data-bestiary-code>OV-ESK-XXX</span>
                        </div>
                        <div class="bestiary-body">
                          <div class="bestiary-visual">
                            <div class="bestiary-photo-frame">
                              <img id="bestiary-image" data-bestiary-image src="/creature.png" alt="Bestiary portrait" />
                              <div class="bestiary-photo-overlay"></div>
                              <div class="bestiary-photo-band"></div>
                            </div>
                            <div class="bestiary-meta">
                              <div class="bestiary-callsign" id="bestiary-callsign" data-bestiary-callsign>Selecciona un dossier</div>
                              <div class="bestiary-line" id="bestiary-classification" data-bestiary-classification>Clasificación: —</div>
                              <div class="bestiary-line" id="bestiary-threat" data-bestiary-threat>Nivel de amenaza: ?</div>
                              <div class="bestiary-line" id="bestiary-status" data-bestiary-status>Estado: —</div>
                              <div class="bestiary-line" id="bestiary-alignment" data-bestiary-alignment>Alineación: —</div>
                            </div>
                          </div>
                          <div class="bestiary-section">
                            <div class="bestiary-section-title">Resumen público</div>
                            <p id="bestiary-summary" data-bestiary-summary class="muted">Sin entidad seleccionada.</p>
                          </div>
                          <div class="bestiary-section bestiary-dm-only">
                            <div class="bestiary-section-title">Comportamiento observado</div>
                            <p id="bestiary-behaviour" data-bestiary-behaviour>—</p>
                          </div>
                          <div class="bestiary-section bestiary-dm-only">
                            <div class="bestiary-section-title">Origen teórico</div>
                            <p id="bestiary-origin" data-bestiary-origin>—</p>
                          </div>
                          <div class="bestiary-section">
                            <div class="bestiary-section-title">MEL (medidas especiales de liquidación)</div>
                            <ul class="bestiary-protocols" id="bestiary-mel" data-bestiary-mel>
                              <li>Sin MEL registradas.</li>
                            </ul>
                          </div>
                          <div class="bestiary-section">
                            <div class="bestiary-section-title">Protocolos</div>
                            <ul class="bestiary-protocols" id="bestiary-protocols" data-bestiary-protocols>
                              <li>—</li>
                            </ul>
                          </div>
                        </div>
                        <div class="bestiary-drawer">
                          <span class="bestiary-drawer-label">Fichero de expediente</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <nav class="workspace-nav journal-nav dm-only" aria-label="Modo de consola">
                <div class="workspace-tabs dm-tabs">
                  <button type="button" class="workspace-tab" data-view="map">Mapa</button>
                  <button type="button" class="workspace-tab" data-view="journal">Journal</button>
                  <button type="button" class="workspace-tab active" data-view="entities">Entidades</button>
                  <button type="button" class="workspace-tab" data-view="relations">Relaciones</button>
                </div>
              </nav>
              <div class="dm-entities-shell">
                <div class="dm-entities-left">
                  <div class="console-card">
                    <div class="card-title">Dossiers</div>
                    <div class="dossier-controls">
                      <div class="dossier-filter-group">
                        <button type="button" class="small ghost dm-filter-type" data-type="">Todos</button>
                        <button type="button" class="small ghost dm-filter-type" data-type="pc">PJ</button>
                        <button type="button" class="small ghost dm-filter-type" data-type="npc">PNJ</button>
                        <button type="button" class="small ghost dm-filter-type" data-type="org">Orgs</button>
                        <button type="button" class="small ghost dm-filter-type" data-type="poi">PdI</button>
                        <button type="button" class="small ghost dm-filter-type" data-type="criatura">EOE</button>
                      </div>
                      <input type="search" id="dm-entity-search" placeholder="Buscar por nombre o rol" />
                    </div>
                    <div class="dossier-list" id="dm-entity-list"></div>
                  </div>
                </div>
                <div class="dm-entity-editor">
                  <div class="console-card dm-entity-form-card" id="dm-entities-detail">
                    <div class="dossier-admin-header">
                      <div>
                        <div class="dm-form-title">Dossier editable</div>
                        <div class="dm-mobile-edit-state">Modo edición</div>
                        <p class="text-xs muted">Actualiza identidad, actividad y control de visibilidad.</p>
                      </div>
                      <div class="entity-editor-actions">
                        <button type="button" class="ghost small dm-mobile-edit-exit" id="dm-mobile-edit-exit">Salir de edición</button>
                        <button type="button" id="entity-new" class="ghost small">Crear nuevo</button>
                        <button type="button" id="entity-cancel" class="ghost small hidden" disabled>Descartar edición</button>
                        <button type="button" data-entity-delete class="danger small hidden">Eliminar entidad</button>
                        <button type="button" id="entity-reset" class="hidden">Reset</button>
                      </div>
                    </div>
                    <form id="entity-form" class="entity-form">
                      <input type="hidden" id="entity-id" />
                      <input type="hidden" id="entity-kind" value="entity" />
                      <div class="dossier-detail-grid">
                        <div class="dossier-col">
                          <div class="form-section">
                            <div class="section-title">Identidad</div>
                            <label for="entity-type">Tipo</label>
                            <select id="entity-type" required>
                              <option value="pc">PJ</option>
                              <option value="npc">PNJ</option>
                              <option value="org">Organización</option>
                              <option value="criatura">Criatura</option>
                              <option value="poi">PdI</option>
                            </select>
                            <label for="entity-code-name">Code name / callsign</label>
                            <input type="text" id="entity-code-name" required />
                            <div class="poi-only inline-fields">
                              <div class="flex-row gap-sm">
                                <div class="flex-col">
                                  <label for="poi-category">Categoría</label>
                                  <select id="poi-category" required></select>
                                </div>
                                <div class="flex-col coord-row">
                                  <label for="poi-latitude">Latitud</label>
                                  <input type="number" step="0.000001" id="poi-latitude" />
                                </div>
                                <div class="flex-col coord-row">
                                  <label for="poi-longitude">Longitud</label>
                                  <input type="number" step="0.000001" id="poi-longitude" />
                                </div>
                              </div>
                              <button type="button" id="pick-location">Elegir del mapa</button>
                            </div>
                            <div class="entity-only">
                              <label for="entity-real-name">Nombre real</label>
                              <input type="text" id="entity-real-name" />
                            </div>
                            <div class="entity-only">
                              <label for="entity-role">Rol / función</label>
                              <input type="text" id="entity-role" />
                            </div>
                          </div>
                          <div class="form-section entity-only">
                            <div class="section-title" id="entity-state-title">Estado y afinidad</div>
                            <div class="inline-fields">
                              <div class="flex-row gap-sm">
                                <div class="flex-col equal">
                                  <div class="entity-only">
                                    <label for="entity-status">Estado</label>
                                    <input type="text" id="entity-status" placeholder="activo, desaparecido..." />
                                  </div>
                                  <div class="poi-only">
                                    <label for="entity-threat">Nivel de amenaza</label>
                                    <input type="number" id="entity-threat" min="1" max="5" />
                                  </div>
                                </div>
                                <div class="flex-col equal">
                                  <div class="entity-only">
                                    <label for="entity-alignment">Alineación</label>
                                    <input type="text" id="entity-alignment" placeholder="ordo_veritatis, esoterror..." />
                                  </div>
                                  <div class="poi-only">
                                    <label for="poi-veil">Estado del velo</label>
                                    <select id="poi-veil">
                                      <option value="intact">Intacto</option>
                                      <option value="frayed">Deshilachado</option>
                                      <option value="torn">Roto</option>
                                    </select>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <label for="entity-image">URL de imagen</label>
                            <input type="url" id="entity-image" placeholder="https://..." />
                          </div>
                          <div class="form-section entity-only">
                            <div class="section-title">Actividad</div>
                            <label for="entity-pois-search">PdIs vinculados</label>
                            <div class="multi-select" id="entity-pois-select">
                              <input type="search" id="entity-pois-search" placeholder="Buscar PdI…"
                                autocomplete="off" />
                              <div class="multi-suggestions" id="entity-pois-suggestions"></div>
                              <div class="multi-chips" id="entity-pois-chips"></div>
                            </div>
                            <input type="hidden" id="entity-pois" />
                            <label for="entity-links-search">Conexiones</label>
                            <div class="multi-select" id="entity-links-select">
                              <input type="search" id="entity-links-search" placeholder="Buscar PJ/PNJ/Org…"
                                autocomplete="off" />
                              <div class="multi-suggestions" id="entity-links-suggestions"></div>
                              <div class="multi-chips" id="entity-links-chips"></div>
                            </div>
                            <input type="hidden" id="entity-links" />
                          </div>
                        </div>
                        <div class="dossier-col">
                          <div class="form-section entity-only">
                            <div class="section-title">Intel</div>
                            <label for="entity-public-note">Resumen público</label>
                            <textarea id="entity-public-note" rows="4"></textarea>
                            <label for="entity-dm-note">Notas DM</label>
                            <textarea id="entity-dm-note" rows="6"></textarea>
                            <div class="creature-only">
                              <label for="entity-mel-entry">MEL (medidas especiales de liquidación)</label>
                              <div class="mel-editor">
                                <div class="multi-chips" id="entity-mel-chips"></div>
                                <div class="mel-inline">
                                  <input type="text" id="entity-mel-entry" placeholder="Añade una MEL y usa AG/DM para alternar visibilidad." />
                                  <button type="button" id="entity-mel-add">Añadir</button>
                                </div>
                                <p class="text-xs muted">Las MEL marcadas como DM no se muestran a agentes.</p>
                              </div>
                              <input type="hidden" id="entity-mel" />
                            </div>
                          </div>
                          <div class="form-section entity-only">
                            <div class="section-title">Control de visibilidad</div>
                            <label for="entity-visibility">Visibilidad</label>
                            <select id="entity-visibility">
                              <option value="agent_public">Visible para agentes</option>
                              <option value="locked">Bloqueada (requiere clave)</option>
                              <option value="dm_only">Solo DM</option>
                            </select>
                            <div class="unlock-fields">
                              <label for="entity-unlock">Código de desbloqueo</label>
                              <input type="text" id="entity-unlock" />
                              <label for="entity-locked-hint">Pista de desbloqueo</label>
                              <input type="text" id="entity-locked-hint" placeholder="Pista breve" />
                            </div>
                            <label class="checkbox-inline">
                              <input type="checkbox" id="entity-archived" /> Archivada
                            </label>
                            <div class="form-actions">
                              <button type="submit" id="entity-submit">Guardar dossier</button>
                              <button type="button" data-entity-delete class="danger small hidden">Borrar
                                Entidad</button>
                            </div>
                          </div>
                          <div class="form-section poi-only poi-extra">
                            <div class="section-title">Conexiones con dossiers</div>
                            <p class="text-xs muted">Vincula este PdI a PJ/PNJ/ORG/EOE (busca por nombre o callsign).</p>
                            <div class="multi-select" id="poi-entity-links-select">
                              <input type="search" id="poi-entity-links-search" placeholder="Buscar PJ/PNJ/Org/EOE…"
                                autocomplete="off" />
                              <div class="multi-suggestions" id="poi-entity-links-suggestions"></div>
                              <div class="multi-chips" id="poi-entity-links-chips"></div>
                            </div>
                            <input type="hidden" id="poi-entity-links" />
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <div class="workspace-view dm-view" data-view="relations">
              <div class="console-stack">
                <div class="console-card" id="dm-relations-card">
                  <div class="card-title">Relaciones (DJ)</div>
                  <div class="dm-graph-toolbar">
                    <div class="dm-graph-search">
                      <label for="dm-graph-search">Entidad</label>
                      <input type="search" id="dm-graph-search" placeholder="Nombre o callsign…" autocomplete="off" />
                      <div class="multi-suggestions" id="dm-graph-suggestions"></div>
                    </div>
                    <div class="graph-selection" id="dm-graph-selection">
                      <div class="graph-selection-actions">
                        <button type="button" class="ghost small" id="dm-graph-add">Añadir grafo</button>
                        <button type="button" class="ghost small" id="dm-graph-clear">Limpiar</button>
                      </div>
                      <div class="multi-chips" id="dm-graph-chips"></div>
                    </div>
                    <button type="button" class="ghost small graph-fullscreen-btn" id="dm-graph-fullscreen">
                      Pantalla completa
                    </button>
                  </div>
                  <div id="dm-graph" class="entity-graph-panel">Selecciona una entidad en Entidades o aquí para ver el grafo.</div>
                  <div class="graph-entity-summary" id="dm-graph-summary">Haz clic en un nodo para abrir su contexto.</div>
                </div>
              </div>
            </div>
          </section>
        </section>
      </div>
      <nav class="mobile-nav" id="mobile-nav">
      <button type="button" class="mobile-tab active" data-mobile-tab="map">
        <span class="mobile-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false">
            <path
              d="M12 21s-6-5.5-6-10a6 6 0 0 1 12 0c0 4.5-6 10-6 10Z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <circle cx="12" cy="11" r="2.5" fill="none" stroke="currentColor" stroke-width="2" />
          </svg>
        </span>
        <span class="mobile-tab-label">Mapa</span>
      </button>
      <button type="button" class="mobile-tab" data-mobile-tab="database">
        <span class="mobile-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false">
            <path
              d="M4 7c0-1.7 3.6-3 8-3s8 1.3 8 3-3.6 3-8 3-8-1.3-8-3Z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            />
            <path
              d="M4 7v5c0 1.7 3.6 3 8 3s8-1.3 8-3V7"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            />
            <path
              d="M4 12v5c0 1.7 3.6 3 8 3s8-1.3 8-3v-5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            />
          </svg>
        </span>
        <span class="mobile-tab-label">Dossier</span>
      </button>
      <button type="button" class="mobile-tab" data-mobile-tab="base">
        <span class="mobile-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false">
            <path
              d="M12 3l7 4v6c0 4-3.3 7-7 8-3.7-1-7-4-7-8V7l7-4Z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"
            />
            <path
              d="M12 8l3 2-3 2-3-2 3-2Z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"
            />
          </svg>
        </span>
        <span class="mobile-tab-label">Entropia</span>
      </button>
      <button type="button" class="mobile-tab" data-mobile-tab="sheet">
        <span class="mobile-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false">
            <path
              d="M7 3h7l5 5v13H7z"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"
            />
            <path
              d="M14 3v5h5"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linejoin="round"
            />
            <path d="M9 12h8M9 16h8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
        </span>
        <span class="mobile-tab-label">Ficha</span>
      </button>
      <button type="button" class="mobile-tab" data-mobile-tab="console">
        <span class="mobile-tab-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" focusable="false">
            <path d="M4 6h16v12H4z" fill="none" stroke="currentColor" stroke-width="2" />
            <path d="M7 10l3 2-3 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M12 14h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
          </svg>
        </span>
        <span class="mobile-tab-label">Consola</span>
      </button>
      </nav>
    </main>
    <div id="mobile-state-badge" class="mobile-state-badge">tab:?<br>view:?<br>mode:?</div>
    <footer class="app-footer">
      <div class="footer-status">
        <span id="footer-membrane-status">ESTABILIDAD DE MEMBRANA: 92%</span>
        <span id="footer-time">PA HORA --:--</span>
      </div>
    </footer>
    <div id="debug-panel" class="debug-panel hidden"></div>
    <div id="inbox-overlay" class="inbox-overlay hidden">
      <div class="inbox-panel">
        <header class="inbox-header">
          <div>
            <div class="inbox-title">BANDEJA DE ENTRADA RETRO</div>
            <div class="inbox-subtitle">Despachos de Integridad de Membrana Activa</div>
          </div>
          <button id="inbox-close" class="ghost small">Cerrar</button>
        </header>
        <div id="inbox-messages" class="inbox-messages"></div>
      </div>
    </div>
    <div id="unlock-overlay" class="unlock-overlay hidden">
      <div class="unlock-panel">
        <header class="unlock-header">
          <div>
            <div class="unlock-title">Dossier bloqueado</div>
            <div id="unlock-hint" class="unlock-hint muted">Protegido. Introduce la clave.</div>
          </div>
          <button type="button" id="unlock-close" class="ghost small">Cerrar</button>
        </header>
        <form id="unlock-form" class="unlock-form">
          <label for="unlock-code-input">Código de desbloqueo</label>
          <input type="password" id="unlock-code-input" autocomplete="off" />
          <div class="form-actions">
            <button type="button" id="unlock-confirm">Desbloquear</button>
          </div>
        </form>
      </div>
    </div>
    <div id="image-lightbox" class="lightbox hidden" role="dialog" aria-modal="true">
      <div class="lightbox-backdrop" data-lightbox-close></div>
      <div class="lightbox-body">
        <button class="lightbox-close" type="button" aria-label="Cerrar" data-lightbox-close>×</button>
        <img id="lightbox-img" alt="Imagen ampliada" />
      </div>
    </div>
  </div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
  <script src="https://unpkg.com/cytoscape@3.29.2/dist/cytoscape.min.js"></script>
  <script src="vendor/weaver.min.js"></script>
  <script src="vendor/cytoscape-spread.js"></script>
  <script src="vendor/cytoscape-dblclick.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <script src="app.v2.js?v=20250201h" type="module"></script>
</body>

</html>
